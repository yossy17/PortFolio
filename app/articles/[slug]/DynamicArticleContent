import { useEffect, useState } from 'react';
import * as shiki from 'shiki';
import cheerio from 'cheerio';
import { consola } from '@/components/Ui/Fonts/Fonts';

export default function DynamicArticleContent({ content }: { content: string }) {
  const [highlightedContent, setHighlightedContent] = useState(content);

  useEffect(() => {
    async function highlightCode() {
      const highlighter = await shiki.getHighlighter({ theme: 'github-dark' });

      const $ = cheerio.load(content);
      $('div[data-filename]').each((_, element) => {
        const filename = $(element).attr('data-filename');
        $(element).prepend(`<p>${filename}</p>`);
        $(element).addClass('Hoge');
        $(element).addClass(consola.className);
      });
      $('pre code').each((_, element) => {
        const code = $(element).text();
        const highlightedCode = highlighter.codeToHtml(code, { lang: 'auto' });
        $(element).parent().replaceWith(highlightedCode);
      });

      setHighlightedContent($.html());
    }

    highlightCode();
  }, [content]);

  return <div dangerouslySetInnerHTML={{ __html: highlightedContent }} />;
}
